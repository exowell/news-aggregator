APP.Main=function(){function p(e,t){function a(){r.innerHTML=n,r.addEventListener("click",g.bind(this,t)),r.classList.add("clickable"),s--}t.time*=1e3;var r=document.querySelector("#s-"+e),n=m(t);requestAnimationFrame(a)}function g(e){var r=t("sd-"+e.id);if(setTimeout(h.bind(this,e.id),60),!r){e.url&&(e.urlobj=new URL(e.url));var n,a,i,o,s=f(e),d=e.kids,c=y({by:"",text:"Loading comment..."});r=document.createElement("section"),r.setAttribute("id","sd-"+e.id),r.classList.add("story-details"),r.innerHTML=s,document.body.appendChild(r),a=r.querySelector(".js-comments"),i=r.querySelector(".js-header"),o=r.querySelector(".js-content");var u=r.querySelector(".js-close");u.addEventListener("click",b.bind(this,e.id));var v=i.getBoundingClientRect().height;if(o.style.paddingTop=v+"px","undefined"==typeof d)return;for(var m=0;m<d.length;m++)n=document.createElement("aside"),n.setAttribute("id","sdc-"+d[m]),n.classList.add("story-details__comment"),n.innerHTML=c,a.appendChild(n),APP.Data.getStoryComment(d[m],function(e){e.time*=1e3;var t=a.querySelector("#sdc-"+e.id);t.innerHTML=y(e,l)})}}function h(e){function i(){a+=.1*(0-a),Math.abs(a)<=.5||(r.style.left=a+"px",requestAnimationFrame(i))}if(!o){o=!0;var r=t("#sd-"+e);if(r){document.body.classList.add("details-active"),r.style.opacity=1;var n=r.getBoundingClientRect(),a=n.left;requestAnimationFrame(i)}}}function b(e){function d(){return l+=.1*(s-l),Math.abs(l-s)<.5?void(o=!1):(r.style.left=l+"px",void requestAnimationFrame(d))}if(o){var r=t("#sd-"+e);document.body.classList.remove("details-active"),r.style.opacity=0;var n=i.getBoundingClientRect(),a=r.getBoundingClientRect(),s=n.width+100,l=a.left;requestAnimationFrame(d)}}function S(){var e=Math.min(70,i.scrollTop),t="scale("+(1-e/300)+")";L.style.height=156-e+"px",q.style.webkitTransform=t,q.style.transform=t,i.scrollTop>70?document.body.classList.add("raised"):document.body.classList.remove("raised")}function C(){if(!(s>0)){s=a;for(var e=n+a,t=n;e>t;t++){if(t>=r.length)return;var o=String(r[t]),l=document.createElement("div");l.setAttribute("id","s-"+o),l.classList.add("story"),l.innerHTML=m({title:"...",score:"-",by:"...",time:0}),i.appendChild(l),APP.Data.getStoryById(r[t],p.bind(this,o))}n+=a}}var e=300,t=document.querySelector.bind(document),r=null,n=0,a=100,i=t("main"),o=!1,s=0,l={data:{intl:{locales:"en-US"}}},d=t("#tmpl-story").textContent,c=t("#tmpl-story-details").textContent,u=t("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var v=/, {{ formatRelative time }}/;d=d.replace(v,""),c=c.replace(v,""),u=u.replace(v,"")}var m=Handlebars.compile(d),f=Handlebars.compile(c),y=Handlebars.compile(u),L=t("header"),q=L.querySelector(".header__title-wrapper");i.addEventListener("scroll",function(){i.scrollTop<=156&&requestAnimationFrame(S);var t=i.scrollHeight-i.offsetHeight-e;i.scrollTop>t&&C()}),APP.Data.getTopStories(function(e){r=e,C(),i.classList.remove("loading")})}();
